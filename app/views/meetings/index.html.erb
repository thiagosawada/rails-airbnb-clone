<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Geocoder</title>

    <link rel="stylesheet" href="../../assets/stylesheets/application.scss">
  </head>
  <body>

    <!-- TODO: Put your HTML code in here -->
    <div class="container text-center">
      <div class="row middle-page">

        <div class="col-xs-12 col-md-8 middle-page" >

              <% @meetings.each do |meeting| %>
                <div class="col-xs-12 col-md-6" >


                  <div class="card-index">
                    <% if meeting.user.facebook_picture_url.present? %>
                      <%= image_tag meeting.user.facebook_picture_url, class: 'card-user' %>
                    <% else %>
                      <%= image_tag 'http://res.cloudinary.com/dpg1ipkol/image/upload/v1502308490/empresario_318-72886_gbwwol.png', class: 'card-user' %>
                    <% end %>
                    <div class="card" style="background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('<%= meeting.photo.url %>');">
                      <% if meeting.user.facebook_picture_url.present? %>
                        <%= image_tag meeting.user.facebook_picture_url, class: 'card-user' %>
                      <% else %>
                        <%= image_tag 'http://res.cloudinary.com/dpg1ipkol/image/upload/v1502308490/empresario_318-72886_gbwwol.png', class: 'card-user' %>
                      <% end %>
                      <h1>
                        <span class="card-name"><%= link_to meeting.name, meeting_path(meeting) %></span>
                      </h1>

                      <div class="card-description">
                        <p>
                        <strong><p><%= meeting.city + ", " + meeting.location %></p></strong>
                        </p>
                      </div>

                    </div>
                  </div>

                </div>
              <% end %>
        </div>

        <div class="col-xs-12 col-md-4">
          <div id="map" style="height: 700px;"></div>
        </div>

      </div>
    </div>

    <% content_for(:after_js) do %>
      <%= javascript_tag do %>
        $(document).ready(function() {
          var handler = Gmaps.build('Google');
          handler.buildMap({ internal: { id: 'map' } }, function() {
            markers = handler.addMarkers(<%= raw @hash.to_json %>);
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
            if (markers.length == 0) {
              handler.getMap().setZoom(2);
            } else if (markers.length == 1) {
              handler.getMap().setZoom(14);
            }
          });
        });
      <% end %>
    <% end %>

  </body>
</html>

